name: github.com/opspec-pkgs/opspec.op.get-latest-version
description: gets the latest version of an opspec op
inputs:
  opRef:
    string:
      constraints:
        minLength: 1
      description: reference to the op; formatted as `host/path/repo#tag`
outputs:
  latestVersion:
    string:
      constraints:
        format: semver
      description: latest version of the op
version: 1.0.0
run:
  serial:
    - op:
        pkg: { ref: github.com/opspec-pkgs/url.parse#1.0.0 }
        inputs:
          url: https://$(opRef)
        outputs:
          parsedOpRef: url
    - op:
        pkg: { ref: github.com/opspec-pkgs/git.repo.clone-https#1.0.0 }
        inputs:
          username: ' '
          password: ' '
          url: $(parsedOpRef.origin)$(parsedOpRef.pathname)
        outputs:
          repo:
    - op:
        pkg: { ref: github.com/opspec-pkgs/git.repo.tags.list#1.0.0 }
        inputs:
          dotGitDir: $(repo/.git)
        outputs:
          tags:
    - op:
        pkg: { ref: github.com/opspec-pkgs/jmespath.query.eval-array#1.0.0 }
        inputs:
          array: $(tags)
          query: '[*].name'
        outputs:
          tags: array
    - op:
        pkg: { ref: github.com/opspec-pkgs/semver.v2.sort#1.0.0 }
        inputs:
          semVers: $(tags)
        outputs:
          semVers:
    - op:
        pkg: { ref: github.com/opspec-pkgs/jmespath.query.eval-array-to-string#1.0.0 }
        inputs:
          array: $(semVers)
          query: '[0]'
        outputs:
          latestVersion: string